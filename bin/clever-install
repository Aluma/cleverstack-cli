#!/usr/bin/env node

GLOBAL.lib = require( (require('path')).join( __dirname, '..', 'lib' ) );

var Promise = require( 'bluebird' )
  , path    = require( 'path' )
  , fs      = require( 'fs' )
  , _       = require( 'lodash' )
  , async   = require( 'async' );

/**  CLI Program
================================*/
GLOBAL.program = require( 'commander' );

program.version( lib.pkg.version )
  .usage( '[options] [modules ...]' )
  .option( '-v, --versions [versions]', 'Install a specific package version.' )

program.on( '--help', function ( ) {
  console.log( '  Examples:' );
  console.log( '    clever install clever-background-tasks' );
  console.log( '    clever install clever-background-tasks@0.0.1' );
  console.log( '' );
} );

program.parse( process.argv );

if (program.args.length < 1) {
  program.help( );
}

Promise.longStackTraces( );

lib.utils.initBar();
lib.utils.installing( 'Modules' );
lib.utils.expandProgress( program.args.length );

lib.utils.startBar(function() {
  lib.utils.info( 'Attempting to install ' + program.args + '...' );
  lib.install
    .run( program.args )
    .then(function() {
      process.exit( 0 );
    }, function ( err ) {
      lib.utils.fail( err );
      process.exit( 1 );
    });
});